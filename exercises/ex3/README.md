# Exercise 3 - Add Application Logic

In this exercise, lets create a logic for the service with the help of Joule. We have our risks and mitigation as our entities, lets create a logic where if the impact of risk is greather than 10000, set the criticality of that risk to high or set it to warning.

<br>__1.__ Go to your __"Storyboard"__, 
- under the services, _select_ __"Open in Graphical Modeler"__, by click on __...__ 
![](/exercises/ex3/images/1_open_gm.png)  

- choose the risk entity and select add logic.
<br>![](/exercises/ex3/images/2_addlogic.png)

<br>__2.__ Once the dialog box appears, _select_ the __default entries__ and then _click_ __Add__
<br>![](/exercises/ex3/images/3_dialoglogic.png)

<br>__3.__ _Specify_ the __logic handlers__ as shown below
- Phase __"After"__
- Standard event __"Read"__

<br>![](/exercises/ex3/images/4_risklogicedit.png)

<br>__4.__ From the Open code editor-drop down, select __Application Logic__
<br>![](/exercises/ex3/images/5_applicationlogicopen.png)

<br>__5.__ When you click on Application Logic, if the Joule panel is already open from a previous exercise, wait for it to reload until you see the text shown below, preceded by the context #srv/code/risks-logic.js.
If the panel is not open, click the Joule icon on the left and enter the following command:
/cap-app-logic #srv/code/risks-logic.js

![](/exercises/ex3/images/6_joule_context.png)
```
if the impact of the current risk is greater than 10000 dollars set the criticality to 1 otherwise to 2
```
![](/exercises/ex3/images//7_impact_text.png)

<br>__6.__ You can now review and accept the AI-generated js-code, then the changes will be reflected in your project file.

> __‚ÑπÔ∏è NOTE__: The file generated by Joule may not be identical for every user. The Application logic produced can vary between participants and may also differ from the screenshots shown in the documentation.

<br>![](/exercises/ex3/images/8_joulesuggestion.png)

<br>__7.__ The code in the ./srv/code/risks-logic.js-file now looks as follows :
```javascript

module.exports = async function(results, request) {
    if (!results) return;

    const { Risks } = cds.entities;

    // Ensure results is an array
    if (!Array.isArray(results)) {
        results = [results];
    }

    for (const risk of results) {
        if (risk.impact !== undefined) {
            risk.criticality = risk.impact > 10000 ? 1 : 2;
        }
    }
};
```

## Summary üìù

You've now added a service logic to your risk management application.

Continue to  [Exercise 4 - Add Business Partner Service & Connect your application to the Sandbox](../ex4/README.md)

